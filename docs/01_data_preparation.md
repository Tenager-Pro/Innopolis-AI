# Документация конвейера подготовки данных

## Обзор
Конвейер подготовки данных для прогнозирования оттока клиентов. Этот ноутбук выполняет операции ETL, включая загрузку данных, очистку, feature engineering и подготовку для моделей машинного обучения.

## Действия

1. Инициализация и настройка
    Цель: Инициализация окружения и подключение к базе данных

    Шаги:
        Импорт необходимых библиотек
        Добавление корневой директории проекта в путь системы
        Настройка параметров визуализации
        Установление подключения к базе данных
        Ключевые функции:
            get_connection_string(): Получает параметры подключения к БД
            create_engine(): Создает движок SQLAlchemy для работы с БД

2. Управление слоями базы данных
    Цель: Подготовка базы данных для новых слоев данных

    Шаги:
        Выполнение drop_layers.sql для удаления существующих слоев
        Создание новых таблиц для очищенных и преобразованных данных

3. Загрузка данных
    Цель: Загрузка сырых данных из CSV-файла
    Функция: load_data_from_csv()
    Расположение: data/load_data.py
    Возвращает: DataFrame pandas с исходными данными о клиентах
    Метрики вывода:
        Количество записей
        Количество признаков

4. Разведочный анализ данных (EDA)
Цель: Анализ распределения данных и взаимосвязей

Выполняемый анализ:

    4.1 Обзор набора данных
        Размеры и размерность
        Типы данных
        Анализ пропущенных значений

    4.2 Анализ целевой переменной
        Распределение оттока (столбчатая диаграмма)
        Процент оттока (круговая диаграмма)
        Топ корреляций с оттоком (горизонтальная столбчатая диаграмма)
        
        Визуализация:
            Размер рисунка: 15x5 дюймов

        Три субплотов:
            Распределение оттока
            Процент оттока
            Топ-5 корреляций с оттоком

5. Очистка данных
Цель: Обработка проблем качества данных

    5.1 Обработка пропущенных значений
        Стратегия:
            Числовые столбцы: Заполнение медианой
            Категориальные столбцы: Заполнение модой
            Исключенные столбцы: CustomerID, Churn (целевая переменная)

    5.2 Удаление дубликатов
        Идентификация и удаление точных дубликатов строк

        Отчет о количестве удаленных дубликатов

    5.3 Обработка выбросов
        Метод: Метод IQR (интерквартильный размах)
        Порог: 1.5 * IQR
        Обработка: Винзоризация (ограничение значений границами)
        Исключенные столбцы: CustomerID, Churn

6. Создание признаков (Feature Engineering)
    Цель: Создание новых признаков и кодирование категориальных переменных

    6.1 Создание новых признаков
        AvgOrdersPerMonth: OrderCount / (Tenure + 1)
        AvgCashbackPerOrder: CashbackAmount / (OrderCount + 1)

    6.2 Кодирование категориальных переменных
        Бинарные категориальные: Label Encoding (метки)
        Многоклассовые категориальные: One-Hot Encoding (бинарное кодирование)

    Хранение:
        Кодировщики меток сохраняются в словаре label_encoders для возможного обратного преобразования

7. Масштабирование признаков
    Цель: Стандартизация признаков для алгоритмов машинного обучения

    Процесс:
    1.Разделение целевой переменной (Churn) и идентификатора (CustomerID)
    2.Масштабирование признаков с использованием StandardScaler
    3.Объединение с целевой переменной и идентификатором
    4.Создание дополнительных признаков:
        EngagementScore: HourSpendOnApp * OrderCount
        SatisfactionComplainRatio: SatisfactionScore / (Complain + 1)
    Масштабатор: StandardScaler (z-нормализация)

8. Сохранение в базу данных
    Цель: Сохранение обработанных данных в PostgreSQL

    Создаваемые слои:
    cleaned_layer: Содержит очищенные данные после предобработки
    features_layer: Содержит масштабированные и созданные признаки

    Методы:
        to_sql() с параметром if_exists='replace'

9. Финализация
    Цель: Создание представлений базы данных и завершение конвейера

    Шаги:
    1.Выполнение layers.sql для создания представлений БД
    2.Отображение сводной статистики по всем этапам
